<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Consulta CPF - Painel Fullscreen</title>
<style>
  /* Reset e base */
  body,html {
    margin:0; padding:0; height:100%;
    background:#111; color:#0f0;
    font-family: monospace;
    display:flex; flex-direction: column;
  }
  #container {
    flex: 0 0 auto;
    text-align:center;
    padding: 20px;
  }
  button#btnExecutar {
    background:#0f0; color:#000; border:none;
    padding:12px 24px; font-size:18px; font-weight:bold;
    border-radius:8px; cursor:pointer;
    transition: background-color 0.3s ease;
  }
  button#btnExecutar:hover {
    background:#0c0;
  }

  /* Painel fullscreen */
  #painel {
    display:none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background:#111;
    color:#0f0;
    font-family: monospace;
    font-size: 14px;
    display: flex;
    flex-direction: column;
    padding: 15px 20px 50px 20px; /* bottom para rodap√© */
    box-sizing: border-box;
    overflow: hidden;
  }

  /* √Årea de input */
  #areaInput {
    width: 100%;
    min-height: 80px;
    max-height: 120px;
    background:#222;
    color:#0f0;
    font-family: monospace;
    font-size: 13px;
    border: 1px solid #0f0;
    border-radius: 6px;
    padding: 10px;
    resize: vertical;
    box-sizing: border-box;
    margin-top: 6px;
  }
  label {
    display:block;
    margin-top: 10px;
    font-weight: bold;
  }

  /* Input arquivo */
  input[type="file"] {
    margin-top: 6px;
    color: #0f0;
  }

  /* Controles com bot√µes organizados */
  #controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin: 15px 0 10px 0;
  }
  #controls button {
    flex: 1 1 120px;
    min-width: 110px;
    background:#0f0;
    color:#000;
    border:none;
    font-weight: bold;
    padding: 10px 0;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #controls button:hover:not(#btnParar) {
    background:#0c0;
  }
  #btnParar {
    background:#f00 !important;
    color:#fff !important;
  }
  #btnParar:hover {
    background:#c00 !important;
  }

  /* Logs ocupam o m√°ximo poss√≠vel, mas deixam espa√ßo para rodap√© */
  #logs {
    flex-grow: 1;
    overflow-y: auto;
    border: 2px solid #0f0;
    padding: 10px;
    background: #000;
    border-radius: 6px;
    white-space: pre-wrap;
    font-size: 13px;
    line-height: 1.3em;
  }

  /* Rodap√© fixo no painel */
  #footer {
    position: fixed;
    bottom: 5px;
    left: 0;
    right: 0;
    text-align: center;
    color: #0f0;
    font-size: 12px;
    font-family: monospace;
    user-select: none;
    pointer-events: none;
  }

  /* Responsivo para telas menores */
  @media (max-width: 480px) {
    #controls button {
      flex: 1 1 100%;
      min-width: auto;
      font-size: 14px;
      padding: 8px 0;
    }
    #areaInput {
      max-height: 100px;
      font-size: 12px;
    }
    #logs {
      font-size: 12px;
    }
    button#btnExecutar {
      font-size: 16px;
      padding: 10px 20px;
    }
  }
</style>
</head>
<body>
  <div id="container">
    <button id="btnExecutar">‚ñ∂Ô∏è Abrir Painel de Consulta</button>
  </div>

  <div id="painel">
    <div>
      <label for="areaInput">Digite CPFs (um por linha):</label>
      <textarea id="areaInput" placeholder="Exemplo:
123.456.789-09
12345678909"></textarea>
    </div>
    <div>
      <label>Ou escolha arquivo TXT com CPFs:</label>
      <input type="file" id="inputArquivo" accept=".txt" />
    </div>
    <div id="controls">
      <button id="btnIniciar">‚ñ∂Ô∏è Executar Consulta</button>
      <button id="btnParar" disabled>‚õî Parar</button>
      <button id="btnFechar">‚úñ Fechar</button>
    </div>
    <div id="logs"></div>
  </div>

  <div id="footer">EG WEBCODE - Todos direitos reservados 2025</div>

<script>
(() => {
  const btnExecutar = document.getElementById('btnExecutar');
  const painel = document.getElementById('painel');
  const logs = document.getElementById('logs');
  const inputArquivo = document.getElementById('inputArquivo');
  const btnParar = document.getElementById('btnParar');
  const btnFechar = document.getElementById('btnFechar');
  const btnIniciar = document.getElementById('btnIniciar');
  const areaInput = document.getElementById('areaInput');

  let parar = false;

  function appendLog(text) {
    logs.textContent += text;
    logs.scrollTop = logs.scrollHeight;
  }

  function isValidCPF(c) {
    c = c.replace(/\D/g,'');
    if(c.length !== 11 || /^(\d)\1{10}$/.test(c)) return false;
    let sum = 0;
    for(let i=0;i<9;i++) sum += +c[i] * (10 - i);
    let d1 = 11 - (sum % 11);
    if(d1 >= 10) d1 = 0;
    if(d1 !== +c[9]) return false;
    sum = 0;
    for(let i=0;i<10;i++) sum += +c[i] * (11 - i);
    let d2 = 11 - (sum % 11);
    if(d2 >= 10) d2 = 0;
    return d2 === +c[10];
  }

  async function consultaCPF(cpf) {
    try {
      const url = `https://caixabrasil.org/consulta/consulta.php?cpf=${cpf}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP error ${res.status}`);
      const json = await res.json();
      return json;
    } catch(e) {
      return null;
    }
  }

  async function executarConsulta(cpfs) {
    parar = false;
    logs.textContent = '';
    btnIniciar.disabled = true;
    btnParar.disabled = false;

    const resultados = [];
    const MAX_CONCORRENCIA = 999;
    let index = 0;

    async function worker() {
      while (index < cpfs.length && !parar) {
        const cpfRaw = cpfs[index++];
        const cpf = cpfRaw.replace(/\D/g, '');
        if (!isValidCPF(cpf)) {
          appendLog(`‚ùå Ignorado CPF inv√°lido: ${cpfRaw}\n`);
          continue;
        }

        appendLog(`üîé Consultando: ${cpf}...\n`);
        const json = await consultaCPF(cpf);
        if (json && json.status === 200 && Array.isArray(json.dados) && json.dados.length > 0) {
          const d = json.dados[0];
          let bloco = `CPF: ${cpf}\n`;
          for (const k in d) {
            bloco += `${k}: ${d[k]}\n`;
            appendLog(`${k}: ${d[k]}\n`);
          }
          bloco += '-----------------------------\n\n';
          resultados.push(bloco);
        } else {
          appendLog(`‚ö†Ô∏è ${cpf} sem dados\n\n`);
        }
      }
    }

    const workers = [];
    for (let i = 0; i < MAX_CONCORRENCIA; i++) {
      workers.push(worker());
    }

    await Promise.all(workers);

    if (resultados.length) {
      const blob = new Blob([resultados.join('\n')], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'resultado_cpfs.txt';
      a.click();
      appendLog('\n‚úÖ Arquivo salvo com os dados encontrados.\n');
    } else {
      appendLog('\n‚ö†Ô∏è Nenhum dado v√°lido para salvar.\n');
    }

    btnIniciar.disabled = false;
    btnParar.disabled = true;
  }

  btnExecutar.onclick = () => {
    painel.style.display = 'flex';
  };

  btnIniciar.onclick = () => {
    let cpfs = [];
    const textoManual = areaInput.value.trim();
    if (textoManual) {
      cpfs = textoManual.split(/\r?\n/).map(x => x.trim()).filter(x => x);
    }
    if (inputArquivo.files.length > 0) {
      const file = inputArquivo.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        const textoArquivo = e.target.result;
        const cpfsArquivo = textoArquivo.split(/\r?\n/).map(x => x.trim()).filter(x => x);
        const listaFinal = [...new Set([...cpfs, ...cpfsArquivo])];
        executarConsulta(listaFinal);
      };
      reader.readAsText(file);
    } else {
      if (cpfs.length === 0) {
        alert('Digite ou selecione pelo menos um CPF!');
        return;
      }
      executarConsulta(cpfs);
    }
  };

  btnParar.onclick = () => {
    parar = true;
    btnParar.disabled = true;
  };

  btnFechar.onclick = () => {
    painel.style.display = 'none';
    logs.textContent = '';
    parar = true;
    btnIniciar.disabled = false;
    btnParar.disabled = true;
    areaInput.value = '';
    inputArquivo.value = '';
  };

})();
</script>
</body>
</html>
