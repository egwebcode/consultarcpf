<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Consulta CPF - Painel Fullscreen</title>
<style>
  body,html {
    margin:0; padding:0; height:100%;
    background:#111; color:#0f0; font-family: monospace;
    display:flex; justify-content:center; align-items:center;
    overflow:hidden;
  }
  #container {
    text-align:center;
  }
  button {
    background:#0f0; color:#000; border:none;
    padding:15px 30px; font-size:18px; font-weight:bold;
    border-radius:8px; cursor:pointer;
  }
  #painel {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:#111;
    color:#0f0;
    font-family: monospace;
    font-size:14px;
    overflow-y:auto;
    white-space: pre-wrap;
    padding:20px;
    box-sizing:border-box;
    display:none;
    flex-direction: column;
  }
  #logs {
    flex-grow:1;
    overflow-y:auto;
    border: 2px solid #0f0;
    padding: 10px;
    margin-top: 10px;
    background:#000;
    border-radius: 6px;
    white-space: pre-wrap;
  }
  #controls {
    display:flex;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
  }
  #btnParar {
    background:#f00; color:#fff;
  }
  #areaInput {
    width:100%;
    height:120px;
    background:#222;
    color:#0f0;
    font-family: monospace;
    font-size: 13px;
    border: 1px solid #0f0;
    border-radius: 6px;
    padding: 10px;
    resize: vertical;
    box-sizing: border-box;
  }
  label {
    display:block;
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>
<div id="container">
  <button id="btnExecutar">‚ñ∂Ô∏è Abrir Painel de Consulta</button>
</div>

<div id="painel">
  <div>
    <label for="areaInput">Digite CPFs (um por linha):</label>
    <textarea id="areaInput" placeholder="Exemplo:&#10;07068093868&#10;12345678900"></textarea>
  </div>
  <div style="margin-top:10px;">
    <label>Ou escolha arquivo TXT com CPFs:</label>
    <input type="file" id="inputArquivo" accept=".txt" />
  </div>
  <div id="controls">
    <button id="btnIniciar">‚ñ∂Ô∏è Executar Consulta</button>
    <button id="btnParar">‚õî Parar</button>
    <button id="btnFechar">‚úñ Fechar</button>
      <h1>By EG WEBCODE @ 2025</h1>
  </div>
  <div id="logs"></div>
</div>

<script>
(() => {
  const btnExecutar = document.getElementById('btnExecutar');
  const painel = document.getElementById('painel');
  const logs = document.getElementById('logs');
  const inputArquivo = document.getElementById('inputArquivo');
  const btnParar = document.getElementById('btnParar');
  const btnFechar = document.getElementById('btnFechar');
  const btnIniciar = document.getElementById('btnIniciar');
  const areaInput = document.getElementById('areaInput');

  let parar = false;

  function appendLog(text) {
    logs.textContent += text;
    logs.scrollTop = logs.scrollHeight;
  }

  function isValidCPF(c) {
    c = c.replace(/\D/g,'');
    if(c.length !== 11 || /^(\d)\1{10}$/.test(c)) return false;
    let sum = 0;
    for(let i=0;i<9;i++) sum += +c[i] * (10 - i);
    let d1 = 11 - (sum % 11);
    if(d1 >= 10) d1 = 0;
    if(d1 !== +c[9]) return false;
    sum = 0;
    for(let i=0;i<10;i++) sum += +c[i] * (11 - i);
    let d2 = 11 - (sum % 11);
    if(d2 >= 10) d2 = 0;
    return d2 === +c[10];
  }

  async function consultaCPF(cpf) {
    try {
      const url = `https://valores-nu.it.com/consult/consulta.php?cpf=${cpf}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error(`HTTP error ${res.status}`);
      const json = await res.json();
      return json;
    } catch(e) {
      return null;
    }
  }

  async function executarConsulta(cpfs) {
    parar = false;
    logs.textContent = '';
    btnIniciar.disabled = true;
    btnParar.disabled = false;

    const resultados = [];

    for(const cpfRaw of cpfs) {
      if(parar) {
        appendLog('\nüõë Consulta interrompida pelo usu√°rio.\n');
        break;
      }
      const cpf = cpfRaw.replace(/\D/g,'');
      if(!isValidCPF(cpf)) {
        appendLog(`‚ùå Ignorado CPF inv√°lido: ${cpfRaw}\n`);
        continue;
      }
      appendLog(`üîé Consultando: ${cpf}...\n`);
      const json = await consultaCPF(cpf);
      if(json && json.status === 200 && Array.isArray(json.dados) && json.dados.length > 0) {
        const d = json.dados[0];
        let bloco = `CPF: ${cpf}\n`;
        for(const k in d) {
          bloco += `${k}: ${d[k]}\n`;
          appendLog(`${k}: ${d[k]}\n`);
        }
        bloco += '-----------------------------\n\n';
        resultados.push(bloco);
      } else {
        appendLog(`‚ö†Ô∏è ${cpf} sem dados\n\n`);
      }
    }

    if(resultados.length) {
      const blob = new Blob([resultados.join('\n')], {type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'resultado_cpfs.txt';
      a.click();
      appendLog('\n‚úÖ Arquivo salvo com os dados encontrados.\n');
    } else {
      appendLog('\n‚ö†Ô∏è Nenhum dado v√°lido para salvar.\n');
    }
    btnIniciar.disabled = false;
    btnParar.disabled = true;
  }

  btnExecutar.onclick = () => {
    painel.style.display = 'flex';
  };

  btnIniciar.onclick = () => {
    let cpfs = [];
    const textoManual = areaInput.value.trim();
    if(textoManual) {
      cpfs = textoManual.split(/\r?\n/).map(x => x.trim()).filter(x => x);
    }
    if(inputArquivo.files.length > 0) {
      const file = inputArquivo.files[0];
      const reader = new FileReader();
      reader.onload = e => {
        const textoArquivo = e.target.result;
        const cpfsArquivo = textoArquivo.split(/\r?\n/).map(x => x.trim()).filter(x => x);
        // Se o usu√°rio digitou e escolheu arquivo, junta os dois
        const listaFinal = [...new Set([...cpfs, ...cpfsArquivo])];
        executarConsulta(listaFinal);
      };
      reader.readAsText(file);
    } else {
      if(cpfs.length === 0) {
        alert('Digite ou selecione pelo menos um CPF!');
        return;
      }
      executarConsulta(cpfs);
    }
  };

  btnParar.onclick = () => {
    parar = true;
    btnParar.disabled = true;
  };

  btnFechar.onclick = () => {
    painel.style.display = 'none';
    logs.textContent = '';
    parar = true;
    btnIniciar.disabled = false;
    btnParar.disabled = true;
    areaInput.value = '';
    inputArquivo.value = '';
  };

})();
</script>

</body>
</html>
